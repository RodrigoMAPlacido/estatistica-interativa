/* =========================================================
   ESTATÍSTICA INTERATIVA — CSS PRINCIPAL (DEPURADO E ORGANIZADO)
   ========================================================= */

/* =========================================================
   1. VARIÁVEIS GLOBAIS
   ========================================================= */
:root {
  --fg:#111827;
  --muted:#4b5563;
  --accent:#1f2937;
  --accentFg:#fff;
  --text:#222;

  --max-width:900px;
  --content-width:850px;

  --border-light:#e5e7eb;
  --border-medium:#6b7280;
}

/* =========================================================
   2. BASE / RESET
   ========================================================= */
html, body { height:100%; }
body {
  color:var(--text);
  background:#fff;
  -webkit-text-size-adjust:100%;
}
body.loading { visibility:hidden; opacity:0; }
body.ready { visibility:visible; opacity:1; transition:opacity .35s ease; }

/* =========================================================
   3. DESKTOP (padrão)
   Ordem: Navegação → Livro → Figuras/Tabelas → KG/KaTeX → Utilitários
   ========================================================= */

/* 3.1 Navegação entre capítulos */
.nav-links {
  margin:60px auto 0;
  padding-top:25px;
  border-top:1px solid #bfbfbf;
  display:flex;
  justify-content:space-between;
  align-items:center;
  max-width:var(--max-width);
  font-size:16px;
  font-family:Georgia,serif;
}
.nav-links a {
  color:#333; text-decoration:none;
  padding:6px 8px; border-bottom:1px solid transparent;
}
.nav-links a:hover { border-bottom-color:#000; }
.nav-links .anterior { flex:1; text-align:left; }
.nav-links .sumario  { flex:1; text-align:center; }
.nav-links .proximo  { flex:1; text-align:right; }

/* 3.2 Layout do livro */
body.textbook {
  max-width:var(--max-width);
  margin:0 auto;
  padding:60px 32px 40px;
  line-height:1.7;
  font-family:et-book,"Palatino Linotype",serif;
  background:#fff;
}

/* Títulos */
body.textbook h1 {
  font-size:2.6rem; font-weight:400; line-height:1.2; margin:0 0 1.8rem;
}
body.textbook h2 {
  font-size:1.9rem; font-weight:400; line-height:1.35; margin:3.5rem 0 1.2rem;
}
body.textbook h3 {
  font-size:1.6rem; font-weight:700; line-height:1.35; margin:4rem 0 1rem 1rem;
}

/* NOVO: h4 — coerente com a hierarquia */
body.textbook h4 {
  font-size:1.4rem;
  font-weight:500;
  line-height:1.35;
  margin:2.3rem 0 1.5rem 2rem;   
}
/* ======================================
   H5 — Título editorial de exemplo
   ====================================== */

body.textbook h5{
  margin-top:0;              /* o bloco controla o espaço */
  margin-bottom:0.6rem;      /* mais respiro visual */

  font-size:0.95rem;
  font-weight:600;
  letter-spacing:0.05em;
  text-transform:uppercase;

  color:var(--ink-soft);

  padding-bottom:0.2rem;     /* separador sutil */
  border-bottom:1px solid rgba(0,0,0,0.04);
}


/* ======================================
   Bloco do exemplo — moldura editorial
   ====================================== */

.example-frame{
  margin:2.2rem auto 2.6rem;   /* mais destaque vertical */
  padding:1rem 1.4rem 1.2rem;  /* respiro interno confortável */
  max-width:var(--content-width);

  border:0.5px solid rgba(0,0,0,0.1);
  border-radius:6px;

  background:transparent;
}


/* ======================================
   Ajustes internos para harmonia
   ====================================== */

.example-frame p{
  margin-bottom:0.9rem;        /* parágrafos respiram */
}

.example-frame .formula{
  margin:1.2rem 0 1.3rem;      /* destaca a matemática */
}


body.textbook .subtitle {
  font-size:1rem; font-weight:700; color:#555;
  margin:1rem 0 0; letter-spacing:.04em; text-transform:uppercase;
}

/* Texto e listas */
body.textbook p, body.textbook li {
  max-width:var(--content-width);
  text-align:justify;
}
body.textbook p { font-size:1.13rem; margin:0 0 1.4rem; }
body.textbook ul {
  margin:0 0 1rem 1.2rem; padding:0;
}
body.textbook ol {
  margin:2rem 2.5rem 2rem; padding:0;
}
body.textbook li { margin:0 0 1.5rem; font-size:1.13rem;}
body.textbook .newthought {
  font-variant:small-caps; font-size:1.28rem; letter-spacing:.03em;
}

/* 3.3 Figuras e SVGs (não-KG) — versão simplificada e corrigida */
figure {
  display:block;
  margin:1.6rem auto 1rem;
  text-align:center;
  max-width:var(--content-width);
  line-height:0; /* remove baseline que cria espaço extra abaixo da imagem */
}

figure > img,
figure > svg {
  display:block;
  margin:0 auto;
  width:100%;
  max-width:750px;
  height:auto;

  image-rendering:-webkit-optimize-contrast;
  image-rendering:crisp-edges;
  text-rendering:geometricPrecision;
  shape-rendering:geometricPrecision;
  vector-effect:non-scaling-stroke;
  backface-visibility:hidden;
}

figure > figcaption {
  line-height:1.25;
  margin:0.4rem 0 1.6rem;
  font-style:italic;
  font-size:1rem;
  color:#444;
}

/* 3.4 Tabelas (responsivo automático) */
figure.figure.table {
  display:flex;
  flex-direction:column;
  align-items:center;
  margin:2rem auto;
  overflow-x:auto;
}

figure.figure.table table {
  border-collapse:collapse;
  table-layout:auto;
  width:90%;
  max-width:100%;
  font-size:1.05rem;
  margin:1.5rem auto;
}

figure.figure.table th,
figure.figure.table td {
  padding:8px 10px;
  border-bottom:1px solid var(--border-light);
  text-align:center;
  line-height:1.45;
  white-space:normal;
}

figure.figure.table thead th {
  font-weight:600;
  border-bottom:2px solid var(--border-medium);
  hyphens:auto;
}

figure.figure.table figcaption {
  display:block;
  margin:0.6rem auto 0;
  text-align:center;
  font-style:italic;
  color:var(--muted);
  font-size:0.9rem;
  max-width:95%;
}

/* 3.5 KGJS e KaTeX */
.kg-container {
  --kg-max-width: var(--content-width);
  --kg-padding: 8px 6px;
  width:100%;
  margin:2rem 0 2rem 0;
  padding:var(--kg-padding);
  background:#fff;
  border-radius:6px;

  overflow:visible;
  overscroll-behavior:contain;
  -webkit-overflow-scrolling:auto;
  pointer-events:auto;
}

.kg-container.kg--sidebar-centered{
  position: relative; /* referência do absolute */
}

.kg-container.kg--sidebar-centered .sidebar{
  left: 15% !important;                 /* vence left inline */
  right: auto !important;
  margin:0rem 0 0rem 0;
}
.kg-container canvas,
.kg-container img {
  max-width:100%;
  width:100% !important;
  height:auto;
  display:block;
}

.kg-container svg {
  max-width:100%;
  height:auto;
  display:block;
}


/* KaTeX */
body.textbook .katex { font-size:1.1em; }
body.textbook .katex-display { font-size:1.15em; margin:1.5rem 0; }

/* KG wrapper */
.kg-wrapper {
  display:flex;
  justify-content:center;
  align-items:center;
  width:100%;
  max-width:620px;
  margin:0 0 0 0;
}
/* =========================================================
   SIDEBAR — TABELA DO EXEMPLO (NÃO AFETA SLIDERS)
   ========================================================= */

.kg-container .sidebar .sidebar-table-wrap{
  overflow-x:auto;
  -webkit-overflow-scrolling:touch;
}

.kg-container .sidebar table{   /* <- reset: não impõe nada em tabelas genéricas */
  border-collapse:separate;
}

.kg-container .sidebar .sidebar-table{
  width:100%;
  border-collapse:collapse;
  font-size:0.9rem;
}
.kg-container .sidebar .sidebar-table th{
  padding:4px 6px;
  border-bottom:2px solid #111827;
  text-align:center;
  line-height:1.25;
  white-space:nowrap;
}
.kg-container .sidebar .sidebar-table td{
  padding:4px 6px;
  border-bottom:1px solid #e5e7eb;
  text-align:center;
  line-height:1.25;
  white-space:nowrap;
}

.kg-container .sidebar .sidebar-table th{
  font-weight:600;
}
/* Sidebar — ajuste fino do título */
.kg-container .sidebar .sidebar-title{
  margin-bottom:10px;   /* valor típico: 2px a 6px */
}

@media (max-width:768px){
  .kg-wrapper.kg-mobile-sidebar .sidebar .sidebar-table{
    width:100%;
    table-layout:fixed;
    font-size:0.78rem;
  }

  .kg-wrapper.kg-mobile-sidebar .sidebar .sidebar-table th,
  .kg-wrapper.kg-mobile-sidebar .sidebar .sidebar-table td{
    padding:3px 4px;
    white-space:normal;
    word-break:break-word;
  }
}

/* =========================================================
   Classe padrão para fórmulas (KaTeX ou MathJax)
   ========================================================= */
.formula {
  display: block;
  text-align: center;
  margin-top: 3.6rem !important;
  margin-bottom: 3.6rem !important;
  line-height: 1.4;
  max-width: var(--content-width);
  margin-left: auto;
  margin-right: auto;
}

.formula .katex-display {
  margin: 1rem 0 !important;
}

.formula .katex {
  font-size: 1rem;
}
/* Fórmulas inline para KaTeX e TTS */
.formula-inline {
  display: inline !important;
  padding: 0 !important;
  margin: 0 !important;
  white-space: nowrap; /* opcional, impede quebra no meio da fórmula */
}

/* Versões responsivas de KG */
.kg-mobile-sidebar, .kg-mobile,
.kg-desktop { display:none; }
@media (min-width:769px) { .kg-desktop { display:block; } }
@media (max-width:768px) { .kg-mobile  { display:block; } }
@media (max-width:768px) { .kg-mobile-sidebar  { display:block; } }

/* 3.6 Botões de scroll (visível apenas no mobile via media abaixo) */
.scroll-buttons {
  position:fixed;
  bottom:calc(16px + env(safe-area-inset-bottom));
  right:16px;
  display:flex;
  flex-direction:column;
  gap:8px;
  z-index:1000;
  opacity:0;
  visibility:hidden;
  transform:translateY(6px);
  transition:opacity .25s ease, visibility .25s ease, transform .25s ease;
}
.scroll-buttons.show { opacity:1; visibility:visible; transform:none; }
.scroll-buttons button {
  width:44px; height:44px;
  border:1px solid rgba(255,255,255,.12);
  border-radius:8px;
  background:rgba(31,41,55,.55);
  color:var(--accentFg);
  font-size:1.15rem;
  font-weight:700;
  display:grid;
  place-items:center;
  line-height:1;
  padding:0;
  box-shadow:0 1px 2px rgba(0,0,0,.06);
  opacity:.95;
  -webkit-tap-highlight-color:transparent;
  touch-action:manipulation;
  transition:opacity .2s ease, transform .2s ease, box-shadow .2s ease;
}
@media (min-width:769px) { .scroll-buttons { display:none; } }
@media (prefers-reduced-motion:reduce) {
  .scroll-buttons,
  .scroll-buttons.show,
  .scroll-buttons button { transition:none !important; }
}

/* =========================================================
   4. MOBILE (<=768px) — mesma ordem do Desktop
   ========================================================= */
@media (max-width:768px) {

  /* 4.1 Navegação */
  .nav-links {
    margin-top:10px;
    padding-top:5px;
    font-size:1.1rem;
    gap:4px;
  }
  .nav-links a { padding:4px 4px; }
  .nav-links .anterior,
  .nav-links .sumario,
  .nav-links .proximo { flex:1; text-align:center; }
  .nav-links .anterior { text-align:left; }
  .nav-links .proximo  { text-align:right; }

  /* 4.2 Livro */
  html { font-size:12px; }
  body.textbook { max-width:100%; padding:10px 10px; line-height:1.5; }

  body.textbook h1 { font-size:1.8rem; line-height:1.22; margin:0 0 .7rem; }
  body.textbook h2 { font-size:1.6rem; line-height:1.24; margin:1.1rem 0 .5rem; }
  body.textbook h3 { font-size:1rem; margin:2.5rem .5rem 1rem; }
  body.textbook h4 { font-size:1rem; margin:2.5rem 1rem 1rem; }

/* --------------------------------------
   H5 — Exemplo (Mobile)
   -------------------------------------- */

body.textbook h5{
  font-size:0.88rem;
  margin-top:0;
  margin-bottom:0.6rem;
  letter-spacing:0.04em;

  padding-bottom:0.2rem;
  border-bottom:1px solid rgba(0,0,0,0.04);
}


/* --------------------------------------
   Bloco do exemplo — Mobile
   -------------------------------------- */

.example-frame{
  margin:1.4rem auto 1.8rem;
  padding:0.9rem 1rem 1rem;
  max-width:95%;

  border:0.8px solid rgba(0,0,0,0.15);
  border-radius:6px;
}


/* --------------------------------------
   Conteúdo interno
   -------------------------------------- */

.example-frame p{
  margin-bottom:0.75rem;
}

.example-frame .formula{
  margin:0.9rem 0 1rem;
}

  body.textbook p,
  body.textbook ul { font-size:.9rem; margin-bottom:.75rem; }
  body.textbook ol { font-size:.9rem; margin:2rem 0.3rem 2rem 1.5rem; }
  body.textbook li { margin:0 0 1.5rem; font-size:0.9rem;}
  body.textbook li.lista { font-size:.9rem; margin:2rem 0.3rem 2rem 1.5rem; }

  /* 4.3 Figuras e SVGs */
  figure { margin:1.2rem 0; padding:0; }
  figure img,
  figure svg {
    width:95vw;
    max-width:none;
    position:relative;
    left:50%;
    transform:translateX(-50%);
  }

  /* 4.3.1 Figcaption — versão mobile */
  figure > figcaption {
    font-size:0.85rem;
    line-height:1.2;
    margin:0.45rem auto 1.2rem;
    max-width:90vw;
    padding:0 4px;
    text-align:center;
    font-style:italic;
    color:#555;
  }

  /* 4.4 Tabelas */
  figure.figure.table { width:100%; overflow-x:hidden; margin:1.5rem auto; }
  figure.figure.table table { font-size:0.8rem; table-layout:fixed; word-break:break-word; }
  figure.figure.table th,
  figure.figure.table td { padding:6px 4px; white-space:normal; }
  figure.figure.table thead th { font-size:0.7rem; }

  /* 4.5 KGJS e KaTeX */
  .kg-wrapper.kg-mobile {
    width:125%;
    max-width:none;
    margin:1.2rem auto 7.2rem 0rem;
    position:relative;
    left:-28.5%;
    transform:none;
    overscroll-behavior: contain;
  }
  .kg-wrapper.kg-mobile svg {
  touch-action: none;          /* bloqueia gestos de scroll dentro do gráfico */
  overscroll-behavior: contain; /* impede scroll lateral dentro do SVG */
}
  /* 4.5 KGJS e KaTeX */
  .kg-wrapper.kg-mobile-sidebar {
    width:100%;
    max-width:none;
    margin:0 0 0 0;
    position:relative;
    left: -15%;
    transform:scale(0.9);
    overscroll-behavior: contain;
  }
  .kg-wrapper.kg-mobile-sidebar svg {
  touch-action: none;          /* bloqueia gestos de scroll dentro do gráfico */
  overscroll-behavior: contain; /* impede scroll lateral dentro do SVG */
}
  body.textbook .katex,
  body.textbook .katex-display { font-size:1.1em !important; overflow-wrap:anywhere; margin:1.2rem 0;}
  /* =========================================================
   KGJS — Compactar sliders + tipografia (somente kg-mobile-sidebar)
   ========================================================= */

.kg-wrapper.kg-mobile-sidebar .sidebar{
  font-size: 1.20rem;
  line-height: 1.2;
}

/* label do slider */
.kg-wrapper.kg-mobile-sidebar .sidebar .slider-label{
  padding: 2px 6px !important;
  font-size: 1rem;
  white-space: nowrap;
}

/* input numérico (classe existe: slider-numberInput) */
.kg-wrapper.kg-mobile-sidebar .sidebar .slider-numberInput{
  font-size: 1rem;
  padding: 2px 2px;
  height: 26px;
  /* vence o width que o JS seta no redraw */
  width: 64px !important;
  min-width: 56px !important;
  max-width: 72px !important;
  box-sizing: border-box;
}

/* o range não tem classe, mas é input[type=range] */
.kg-wrapper.kg-mobile-sidebar .sidebar input[type="range"]{
  height: 6px;
}

/* reduz espaço entre linhas/controles */
.kg-wrapper.kg-mobile-sidebar .sidebar tr{
  height: auto;
}

.kg-wrapper.kg-mobile-sidebar .sidebar td{
  padding-top: 0px !important;
  padding-bottom: 0px !important;

}

}

/* =========================================================
   BOTÃO FLUTUANTE — TEXT-TO-SPEECH
   Posição e estilo geral
   ========================================================= */

#tts-floating-btn {
  position: fixed;
  bottom: 24px;
  right: 24px; /* Desktop: canto inferior direito */
  z-index: 9999;

  background: var(--accent, #64748b);
  color: #fff;
  font-family: var(--font, "et-book", Georgia, serif);

  padding: 12px 18px;
  border: none;
  border-radius: 8px;

  font-size: 1rem;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);

}

#tts-floating-btn:hover {
  transform: scale(1);
  opacity: 0.9;
}

/* =========================================================
   MOBILE — mudar para o canto inferior esquerdo
   ========================================================= */
@media (max-width: 768px) {
  #tts-floating-btn {
    right: auto;
    left: 16px; /* Mobile: canto inferior esquerdo */
    bottom: 16px;
    opacity: 0.6;
    padding: 10px 16px;
    font-size: 0.9rem;
  }
}
.tts-highlight {
  background: rgba(134, 134, 134, 0.45);
  padding: 2px 3px;
  border-radius: 4px;
  box-decoration-break: clone;
}
/* =========================================================
   BOTÃO DE VELOCIDADE — posicionamento ao lado do TTS
   ========================================================= */

#tts-speed-btn {
  position: fixed;
  bottom: 24px;
  right: 130px; /* Desktop: canto inferior direito */
  z-index: 9999;

  background: var(--accent, #64748b);
  color: #fff;
  font-family: var(--font, "et-book", Georgia, serif);

  padding: 10px 14px;
  border-radius: 8px;
  cursor: pointer;
  user-select: none;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

#tts-speed-btn:hover {
  transform: scale(1);
  opacity: 0.9;
}

#tts-speed-value {
  font-size: 0.95rem;
  font-weight: 600;
}

/* =========================================================
   MOBILE — acompanha o botão principal
   ========================================================= */
@media (max-width: 768px) {
  #tts-speed-btn {
    bottom: 16px;
    right: auto;
    opacity: 0.6;
    left: calc(20px + 95px);
    padding: 8px 12px;
  }
}
.tts-hidden {
  opacity: 0 !important;
  pointer-events: none !important;
}
@media (max-width:768px) {
  .formula {
    margin-top: 1.8rem !important;
    margin-bottom: 1.8rem !important;
  }

  .formula .katex {
    font-size: 1rem !important;
  }
}
