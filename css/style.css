/* =========================================================
   ESTATÍSTICA INTERATIVA — CSS PRINCIPAL (DEPURADO E ORGANIZADO)
   ========================================================= */

/* =========================================================
   1. VARIÁVEIS GLOBAIS
   ========================================================= */
:root {
  --fg:#111827;
  --muted:#4b5563;
  --accent:#1f2937;
  --accentFg:#fff;
  --text:#222;

  --max-width:900px;
  --content-width:850px;

  --border-light:#e5e7eb;
  --border-medium:#6b7280;
}

/* =========================================================
   2. BASE / RESET
   ========================================================= */
html, body { height:100%; }
body {
  color:var(--text);
  background:#fff;
  -webkit-text-size-adjust:100%;
}
body.loading { visibility:hidden; opacity:0; }
body.ready { visibility:visible; opacity:1; transition:opacity .35s ease; }

/* =========================================================
   3. DESKTOP (padrão)
   Ordem: Navegação → Livro → Figuras/Tabelas → KG/KaTeX → Utilitários
   ========================================================= */

/* 3.1 Navegação entre capítulos */
.nav-links {
  margin:60px auto 0;
  padding-top:25px;
  border-top:1px solid #bfbfbf;
  display:flex;
  justify-content:space-between;
  align-items:center;
  max-width:var(--max-width);
  font-size:16px;
  font-family:Georgia,serif;
}
.nav-links a {
  color:#333; text-decoration:none;
  padding:6px 8px; border-bottom:1px solid transparent;
}
.nav-links a:hover { border-bottom-color:#000; }
.nav-links .anterior { flex:1; text-align:left; }
.nav-links .sumario  { flex:1; text-align:center; }
.nav-links .proximo  { flex:1; text-align:right; }

/* 3.2 Layout do livro */
body.textbook {
  max-width:var(--max-width);
  margin:0 auto;
  padding:60px 32px 40px;
  line-height:1.7;
  font-family:et-book,"Palatino Linotype",serif;
  background:#fff;
}

/* Títulos */
body.textbook h1 {
  font-size:2.6rem; font-weight:400; line-height:1.2; margin:0 0 1.8rem;
}
body.textbook h2 {
  font-size:1.9rem; font-weight:400; line-height:1.35; margin:3.5rem 0 1.2rem;
}
body.textbook h3 {
  font-size:1.4rem; font-weight:700; line-height:1.35; margin:2.3rem 0 1rem 1rem;
}

/* NOVO: h4 — coerente com a hierarquia */
body.textbook h4 {
  font-size:1.4rem;
  font-weight:600;
  line-height:1.35;
  margin:2.3rem 0 1rem 2rem;   
}

body.textbook .subtitle {
  font-size:1rem; font-weight:700; color:#555;
  margin:1rem 0 0; letter-spacing:.04em; text-transform:uppercase;
}

/* Texto e listas */
body.textbook p, body.textbook li {
  max-width:var(--content-width);
  text-align:justify;
}
body.textbook p { font-size:1.13rem; margin:0 0 1.4rem; }
body.textbook ul {
  margin:0 0 1rem 1.2rem; padding:0;
}
body.textbook ol {
  margin:2rem 2.5rem 2rem; padding:0;
}
body.textbook li { margin:0 0 1.5rem; font-size:1.13rem;}
body.textbook .newthought {
  font-variant:small-caps; font-size:1.28rem; letter-spacing:.03em;
}

/* 3.3 Figuras e SVGs (não-KG) — versão simplificada e corrigida */
figure {
  display:block;
  margin:1.6rem auto 1rem;
  text-align:center;
  max-width:var(--content-width);
  line-height:0; /* remove baseline que cria espaço extra abaixo da imagem */
}

figure > img,
figure > svg {
  display:block;
  margin:0 auto;
  width:100%;
  max-width:750px;
  height:auto;

  image-rendering:-webkit-optimize-contrast;
  image-rendering:crisp-edges;
  text-rendering:geometricPrecision;
  shape-rendering:geometricPrecision;
  vector-effect:non-scaling-stroke;
  backface-visibility:hidden;
}

figure > figcaption {
  line-height:1.25;
  margin:0.4rem 0 1.6rem;
  font-style:italic;
  font-size:1rem;
  color:#444;
}

/* 3.4 Tabelas (responsivo automático) */
figure.figure.table {
  display:flex;
  flex-direction:column;
  align-items:center;
  margin:2rem auto;
  overflow-x:auto;
}

figure.figure.table table {
  border-collapse:collapse;
  table-layout:auto;
  width:90%;
  max-width:100%;
  font-size:1.05rem;
  margin:1.5rem auto;
}

figure.figure.table th,
figure.figure.table td {
  padding:8px 10px;
  border-bottom:1px solid var(--border-light);
  text-align:center;
  line-height:1.45;
  white-space:normal;
}

figure.figure.table thead th {
  font-weight:600;
  border-bottom:2px solid var(--border-medium);
  hyphens:auto;
}

figure.figure.table figcaption {
  display:block;
  margin:0.6rem auto 0;
  text-align:center;
  font-style:italic;
  color:var(--muted);
  font-size:0.9rem;
  max-width:95%;
}

/* 3.5 KGJS e KaTeX */
.kg-container {
  --kg-max-width: var(--content-width);
  --kg-padding: 8px 6px;
  width:100%;
  margin:2rem 0 5rem 0;
  padding:var(--kg-padding);
  background:#fff;
  border-radius:6px;

  overflow:visible;
  overscroll-behavior:contain;
  -webkit-overflow-scrolling:auto;
  pointer-events:auto;
}

.kg-container canvas,
.kg-container svg,
.kg-container img {
  max-width:100%;
  width:100% !important;
  height:auto;
  display:block;
}

/* KaTeX */
body.textbook .katex { font-size:1.1em; }
body.textbook .katex-display { font-size:1.15em; margin:1.5rem 0; }

/* KG wrapper */
.kg-wrapper {
  display:flex;
  justify-content:center;
  align-items:center;
  width:100%;
  max-width:620px;
  margin:0 0 0 0;
}

/* Versões responsivas de KG */
.kg-mobile,
.kg-desktop { display:none; }
@media (min-width:769px) { .kg-desktop { display:block; } }
@media (max-width:768px) { .kg-mobile  { display:block; } }

/* 3.6 Botões de scroll (visível apenas no mobile via media abaixo) */
.scroll-buttons {
  position:fixed;
  bottom:calc(16px + env(safe-area-inset-bottom));
  right:16px;
  display:flex;
  flex-direction:column;
  gap:8px;
  z-index:1000;
  opacity:0;
  visibility:hidden;
  transform:translateY(6px);
  transition:opacity .25s ease, visibility .25s ease, transform .25s ease;
}
.scroll-buttons.show { opacity:1; visibility:visible; transform:none; }
.scroll-buttons button {
  width:44px; height:44px;
  border:1px solid rgba(255,255,255,.12);
  border-radius:8px;
  background:rgba(31,41,55,.55);
  color:var(--accentFg);
  font-size:1.15rem;
  font-weight:700;
  display:grid;
  place-items:center;
  line-height:1;
  padding:0;
  box-shadow:0 1px 2px rgba(0,0,0,.06);
  opacity:.95;
  -webkit-tap-highlight-color:transparent;
  touch-action:manipulation;
  transition:opacity .2s ease, transform .2s ease, box-shadow .2s ease;
}
@media (min-width:769px) { .scroll-buttons { display:none; } }
@media (prefers-reduced-motion:reduce) {
  .scroll-buttons,
  .scroll-buttons.show,
  .scroll-buttons button { transition:none !important; }
}

/* =========================================================
   4. MOBILE (<=768px) — mesma ordem do Desktop
   ========================================================= */
@media (max-width:768px) {

  /* 4.1 Navegação */
  .nav-links {
    margin-top:10px;
    padding-top:5px;
    font-size:1.1rem;
    gap:4px;
  }
  .nav-links a { padding:4px 4px; }
  .nav-links .anterior,
  .nav-links .sumario,
  .nav-links .proximo { flex:1; text-align:center; }
  .nav-links .anterior { text-align:left; }
  .nav-links .proximo  { text-align:right; }

  /* 4.2 Livro */
  html { font-size:12px; }
  body.textbook { max-width:100%; padding:10px 10px; line-height:1.5; }

  body.textbook h1 { font-size:1.8rem; line-height:1.22; margin:0 0 .7rem; }
  body.textbook h2 { font-size:1.6rem; line-height:1.24; margin:1.1rem 0 .5rem; }
  body.textbook h3 { font-size:1rem; margin:2.5rem .5rem 1rem; }
  body.textbook h4 { font-size:1rem; margin:2.5rem 1rem 1rem; }


  body.textbook p,
  body.textbook ul { font-size:.9rem; margin-bottom:.75rem; }
  body.textbook ol { font-size:.9rem; margin:2rem 0.3rem 2rem 1.5rem; }
  body.textbook li.lista { font-size:.9rem; margin:2rem 0.3rem 2rem 1.5rem; }

  /* 4.3 Figuras e SVGs */
  figure { margin:1.2rem 0; padding:0; }
  figure img,
  figure svg {
    width:95vw;
    max-width:none;
    position:relative;
    left:50%;
    transform:translateX(-50%);
  }

  /* 4.3.1 Figcaption — versão mobile */
  figure > figcaption {
    font-size:0.85rem;
    line-height:1.2;
    margin:0.45rem auto 1.2rem;
    max-width:90vw;
    padding:0 4px;
    text-align:center;
    font-style:italic;
    color:#555;
  }

  /* 4.4 Tabelas */
  figure.figure.table { width:100%; overflow-x:hidden; margin:1.5rem auto; }
  figure.figure.table table { font-size:0.8rem; table-layout:fixed; word-break:break-word; }
  figure.figure.table th,
  figure.figure.table td { padding:6px 4px; white-space:normal; }
  figure.figure.table thead th { font-size:0.7rem; }

  /* 4.5 KGJS e KaTeX */
  .kg-wrapper.kg-mobile {
    width:125%;
    max-width:none;
    margin:1.2rem auto 7.2rem 0rem;
    position:relative;
    left:-28.5%;
    transform:none;
    overscroll-behavior: contain;
  }
  .kg-wrapper.kg-mobile svg {
  touch-action: none;          /* bloqueia gestos de scroll dentro do gráfico */
  overscroll-behavior: contain; /* impede scroll lateral dentro do SVG */
}
  body.textbook .katex,
  body.textbook .katex-display { font-size:1.1em !important; overflow-wrap:anywhere; margin:1.2rem 0;}
}

