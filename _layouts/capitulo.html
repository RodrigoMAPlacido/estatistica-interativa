<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <title>{{ page.title }} | Estatística Interativa</title>
  {% include head.html %}
</head>

<body class="textbook loading">

  {% include header.html %}

  <main class="content">
    <h1>{{ page.title }}</h1> <!-- ✅ agora o título aparece -->
    {{ content }}
  </main>

  <div class="nav-links">
    {% if page.anterior %}
      <a class="anterior" href="{{ page.anterior | relative_url }}">← Capítulo Anterior</a>
    {% endif %}
    <a class="sumario" href="{{ '/sumario.html' | relative_url }}">Voltar ao Sumário</a>
    {% if page.proximo %}
      <a class="proximo" href="{{ page.proximo | relative_url }}">Próximo capítulo →</a>
    {% endif %}
  </div>

  {% include footer.html %}
  {% include body.html %}
<!-- Botões de scroll (mobile, discretos) -->
<div class="scroll-buttons" aria-hidden="true">
  <button id="scroll-up" aria-label="Voltar ao topo" title="Topo">↑</button>
  <button id="scroll-down" aria-label="Ir para o fim" title="Fim">↓</button>
</div>
<script>
  (function () {
    const scrollBtns = document.querySelector('.scroll-buttons');
    const btnUp = document.getElementById('scroll-up');
    const btnDown = document.getElementById('scroll-down');

    function toggleButtons() {
      const scrollY = window.scrollY;
      const viewportHeight = window.innerHeight;
      const pageHeight = document.documentElement.scrollHeight;
      const nearBottom = scrollY + viewportHeight >= pageHeight - 120; // margem antes do final

      if (scrollY < 160) {
        // No topo: esconde
        scrollBtns.classList.remove('show');
      } else if (nearBottom) {
        // Perto do rodapé: fade-out
        scrollBtns.classList.remove('show');
      } else {
        // Meio da página: mostra normal
        scrollBtns.classList.add('show');
      }
    }

    // Respeita acessibilidade
    const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const behavior = prefersReduced ? 'auto' : 'smooth';

    btnUp.addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior });
    });

    btnDown.addEventListener('click', () => {
      window.scrollTo({ top: document.documentElement.scrollHeight, behavior });
    });

    // Listener
    toggleButtons();
    window.addEventListener('scroll', toggleButtons, { passive: true });
  })();
</script>

<script src="{{ '/js/tts.js' | relative_url }}"></script>

<button id="tts-floating-btn" aria-label="Ouvir este capítulo">
  ▶ Ouvir
</button>
<script>
  const btn = document.getElementById("tts-floating-btn");

  btn.addEventListener("click", () => {
    const state = SPEECH.getStatus();

    if (state === "stopped") {
      SPEECH.speakSequential();
      btn.textContent = "Pausar";

    } else if (state === "playing") {
      SPEECH.pause();
      btn.textContent = "▶ Play";

    } else if (state === "paused") {
      btn.textContent = "Pausar";
      SPEECH.resume();   // <- ordem correta
    }
  });
</script>
<!-- apoiar -->
<script src="{{ '/js/apoiar.js' | relative_url }}"></script>
<div id="support-widget" class="support-widget" aria-label="Apoiar o projeto">
  <!-- Hint: TEXTO + SETA (um bloco só) -->
  <div  id="support-hint" class="support-hint" role="note" aria-hidden="false">
    <div class="support-hint__text">
      Este projeto valeria<br>
      um refrigerante<br>
      para você?
    </div>

<svg class="support-hint__arrow" viewBox="0 0 100 120" aria-hidden="true">
  <!-- arco suave (sem “quebra”), terminando com tangente para cima-direita -->
  <path d="M46,112
           C20,96 16,64 30,44
           C42,26 64,26 84,36" />
  <!-- ponta alinhada à tangente final, com vértice em (84,36) -->
  <path d="M74,26 L84,36 L72,44" />
</svg>

  </div>

  <!-- Botão fixo -->
  <a
    id="support-button"
    class="support-button"
    href="https://apoia.se/estatistica-interativa"
    target="_blank"
    rel="noopener noreferrer"
  >
    Apoiar
  </a>
</div>

<div id="tts-speed-btn">
  <span id="tts-speed-value">1.0×</span>
</div>
<script>
  const speedBtn = document.getElementById("tts-speed-btn");
  const speedValue = document.getElementById("tts-speed-value");

  // Ao clicar, ciclo: 1.0 → 1.2 → 1.4 → ... → 2.0 → volta ao 0.8
  speedBtn.addEventListener("click", () => {
    let current = SPEECH.rate;
    current += 0.2;
    if (current > 2.0) current = 0.8; // reinicia o ciclo

    SPEECH.setRate(current);
    speedValue.textContent = current.toFixed(1) + "×";
  });
</script>
 <script>
(function () {

  const ttsBtn   = document.getElementById("tts-floating-btn");
  const speedBtn = document.getElementById("tts-speed-btn");

  function hideTTSAtPageEnd() {
    const scrollY    = window.scrollY;
    const viewport   = window.innerHeight;
    const pageHeight = document.documentElement.scrollHeight;

    const atBottom = scrollY + viewport >= pageHeight - 80;

    if (atBottom) {
      ttsBtn.classList.add("tts-hidden");
      speedBtn.classList.add("tts-hidden");
    } else {
      ttsBtn.classList.remove("tts-hidden");
      speedBtn.classList.remove("tts-hidden");
    }
  }

  hideTTSAtPageEnd();
  window.addEventListener("scroll", hideTTSAtPageEnd, { passive: true });

})();
</script>
</body>
</html>
